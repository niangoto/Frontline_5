<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Frontline Editor</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        #container {
            display: flex;
            gap: 20px;
        }
        #canvas-container {
            position: relative;
            width: 700px;
            height: 600px;
            border: 1px solid #333;
            overflow: hidden;
        }

        #bg-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        #editor-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 1;
        }

        #controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 10px;
            background: #f5f5f5;
            border: 1px solid #ddd;
        }
        button {
            padding: 8px 16px;
            cursor: pointer;
        }
        #output {
            width: 300px;
            height: 400px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="canvas-container">
            <img id="bg-image" src="img/map1.png" alt="Map background" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0;pointer-events:none;">
            <canvas id="editor-canvas" width="700" height="600" style="position:absolute;top:0;left:0;width:100%;height:100%;background:transparent;z-index:1;"></canvas>
        </div>
        <div id="controls">
            <button id="toggle-bg">Toggle Background</button>
            <button id="toggle-mode">Mode: Frontline</button>
            <button id="clear-points">Clear Points</button>
            <button id="undo">Undo Last Point</button>
            <button id="export">Export Points</button>
            <textarea id="output" placeholder="Points will appear here..."></textarea>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('editor-canvas');
        const ctx = canvas.getContext('2d');
        let points = [];
        let seaZones = [];
        let currentSeaZone = [];
        let isDrawingFrontline = true;

        // Event Listeners
        canvas.addEventListener('click', handleClick);
        // Toggle background button disables/enables the image visibility
        document.getElementById('toggle-bg').addEventListener('click', () => {
            const bg = document.getElementById('bg-image');
            bg.style.display = (bg.style.display === 'none') ? 'block' : 'none';
        });
        document.getElementById('toggle-mode').addEventListener('click', () => {
            isDrawingFrontline = !isDrawingFrontline;
            const btn = document.getElementById('toggle-mode');
            btn.textContent = `Mode: ${isDrawingFrontline ? 'Frontline' : 'Sea Zone'}`;
        });
        document.getElementById('clear-points').addEventListener('click', () => {
            if (isDrawingFrontline) {
                points = [];
            } else {
                seaZones = [];
                currentSeaZone = [];
            }
            draw();
        });
        document.getElementById('undo').addEventListener('click', () => {
            if (isDrawingFrontline) {
                points.pop();
            } else if (currentSeaZone.length > 0) {
                currentSeaZone.pop();
            } else if (seaZones.length > 0) {
                seaZones.pop();
            }
            draw();
        });
        document.getElementById('export').addEventListener('click', exportPoints);

        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = Math.round(e.clientX - rect.left);
            const y = Math.round(e.clientY - rect.top);

            if (isDrawingFrontline) {
                points.push([x, y]);
            } else {
                if (e.shiftKey && currentSeaZone.length > 2) {
                    // Close current sea zone
                    seaZones.push([...currentSeaZone]);
                    currentSeaZone = [];
                } else {
                    currentSeaZone.push([x, y]);
                }
            }
            draw();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw frontline
            if (points.length > 0) {
                ctx.beginPath();
                ctx.moveTo(points[0][0], points[0][1]);
                for (let i = 1; i < points.length; i++) {
                    ctx.lineTo(points[i][0], points[i][1]);
                }
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw points
                points.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point[0], point[1], 3, 0, Math.PI * 2);
                    ctx.fillStyle = 'red';
                    ctx.fill();
                });
            }

            // Draw sea zones
            seaZones.forEach(zone => drawZone(zone, 'blue'));
            drawZone(currentSeaZone, 'green');
        }

        function drawZone(zone, color) {
            if (zone.length > 0) {
                ctx.beginPath();
                ctx.moveTo(zone[0][0], zone[0][1]);
                for (let i = 1; i < zone.length; i++) {
                    ctx.lineTo(zone[i][0], zone[i][1]);
                }
                if (zone.length > 2) {
                    ctx.closePath();
                }
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw points
                zone.forEach(point => {
                    ctx.beginPath();
                    ctx.arc(point[0], point[1], 3, 0, Math.PI * 2);
                    ctx.fillStyle = color;
                    ctx.fill();
                });
            }
        }

        function exportPoints() {
            const output = document.getElementById('output');
            let text = '// Frontline points:\n';
            text += `const FRONTLINE_POINTS = ${JSON.stringify(points)};\n\n`;
            text += '// Sea zones:\n';
            text += `const SEA_ZONES = ${JSON.stringify(seaZones)};`;
            output.value = text;
        }

        // Initial draw
        draw();
    </script>
</body>
</html>